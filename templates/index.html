<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fileigloo</title>

    <link rel="icon" href="/public/favicon.png">
    <link rel="stylesheet" href="https://unpkg.com/pcss-framework/dist/pcss.min.css">

    <style>
        #alert {
            display: none;
        }
        
        #file-select {
            display: block;
            background: #161f27;
            border-radius: 6px;
            color: #dbdbdb;
            cursor: pointer;
            margin-bottom: 8px;
        }

        #file-select #file-select-filename {
            display: inline-block;
            padding-left: 12px;
        }

        #file-select #file-select-button {
            display: inline-block;
            padding: 10px 14px;
            background: #1a242f;
        }

        #file-select:hover #file-select-button {
            background: #324759;
            transition: all 0.2s ease-in-out;
	        -moz-transition: all 0.2s ease-in-out;
	        -webkit-transition: all 0.2s ease-in-out;
	        -o-transition: all 0.2s ease-in-out;
        }

        #file-select-input {
            display: none;
        }

        #pastebin-input {
            font-family: monospace;
        }
    </style>
</head>

<body>
    <main>
        <center>
            <a href="/">
                <img src="/public/logo-transparent-white.svg" width="168" />
            </a>
        </center>

        <div id="alert">
            <fieldset>
                <legend>Message</legend>
                <center></center>
            </fieldset>
        </div>

        <section id="file-upload">
            <fieldset>
                    <legend>File Upload</legend>
                    <div id="file-select">
                        <div id="file-select-button">Choose File</div>
                        <div id="file-select-filename">No file chosen...</div>
                        <input id="file-select-input" type="file" name="file" />
                    </div>
                    <button id="file-upload-button" type="submit">Upload</button>
            </fieldset>
        </section>

        <section id="pastebin">
            <div>
                <fieldset>
                    <legend>Pastebin</legend>
                    <textarea id="pastebin-input" autocomplete="off" rows="8"></textarea>
                    <button id="pastebin-button" type="submit">Create</button>
                </fieldset>
            </div>
        </section>

        <footer>
            Copyright (c) 2021 by Kamil Marut |
            <a href="https://github.com/exler/fileigloo" target="_blank" rel="noopener noreferrer">Github</a>
        </footer>
    </main>
    <script>
        function upload(content, type = "file") {
            const url = "/";
            const request = new XMLHttpRequest();
            const fd = new FormData();

            request.open("POST", url, true);
            request.onreadystatechange = function() {
                if (request.readyState == 4 && request.status == 200) {
                    let response = JSON.parse(request.responseText);
                    let message;
                    if (type === "text")
                        message = `Upload successful: <a href="${response["FileUrl"]}?inline">${response["FileUrl"]}?inline</a>`
                    else
                        message = `Upload successful: <a href="${response["FileUrl"]}">${response["FileUrl"]}</a>`
                    displayAlert(message);
                } else if (request.status == 400) {
                    displayAlert("Bad request. Please try again.");
                } else {
                    displayAlert("A server error occurred. Please try again.");
                }
            };

            fd.append(type, content);
            request.send(fd);
        }

        function displayAlert(content) {
            let alert = document.getElementById("alert");
            let alertText = alert.getElementsByTagName("center")[0];
            alertText.innerHTML = content;
            alert.style.display = "block";
        }

        window.onload = function() {
            let uploadButton = document.getElementById("file-upload-button");
            let pastebinButton = document.getElementById("pastebin-button");
            uploadButton.onclick = function() {
                let uploadInput = document.getElementById("file-select-input");
                let file = uploadInput.files[0];
                upload(file, "file");
            }
            pastebinButton.onclick = function() {
                let pastebinInput = document.getElementById("pastebin-input");
                let text = pastebinInput.value;
                upload(text, "text");
            }

            let fileSelect = document.getElementById("file-select");
            let fileInput = document.getElementById("file-select-input");
            fileSelect.onclick = function() { fileInput.click(); }
            fileInput.onchange = function() {
                let filename = fileInput.files[0].name;
                let selectFilename = document.getElementById("file-select-filename");
                selectFilename.innerText = filename;
            }
        }
    </script>
</body>

</html>
